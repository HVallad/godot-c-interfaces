{
  "project": "Godot Engine",
  "version": "1.0",
  "description": "Automatic coding rules and guidelines for Godot Engine development",
  "global_rules": {
    "code_style": {
      "indentation": "tabs (4 spaces equivalent)",
      "line_length": 120,
      "line_endings": "LF",
      "charset": "UTF-8",
      "trailing_whitespace": "remove",
      "final_newline": true
    },
    "naming_conventions": {
      "cpp_classes": "PascalCase",
      "cpp_methods": "snake_case",
      "cpp_members": "snake_case with m_ prefix",
      "cpp_constants": "UPPER_SNAKE_CASE",
      "cpp_macros": "UPPER_SNAKE_CASE with _ prefix",
      "gdscript_classes": "PascalCase",
      "gdscript_functions": "snake_case",
      "gdscript_variables": "snake_case",
      "gdscript_constants": "UPPER_SNAKE_CASE",
      "csharp_classes": "PascalCase",
      "csharp_methods": "PascalCase",
      "csharp_properties": "PascalCase",
      "csharp_private_fields": "_camelCase"
    },
    "memory_management": {
      "cpp_allocation": "memnew/memdelete",
      "reference_counting": "Ref<T>",
      "array_allocation": "memnew_arr/memdelete_arr",
      "no_manual_new_delete": true
    },
    "error_handling": {
      "use_error_codes": true,
      "validation_macros": ["ERR_FAIL_NULL_MSG", "ERR_FAIL_INDEX_MSG", "ERR_FAIL_COND_MSG"],
      "always_provide_messages": true,
      "no_exceptions": true
    },
    "threading": {
      "use_thread_safe_macros": true,
      "mutex_types": ["Mutex", "BinaryMutex", "RWLock"],
      "lock_guards": "MutexLock",
      "atomic_operations": "std::atomic"
    },
    "testing": {
      "required": true,
      "location": "tests/",
      "naming_pattern": "test_*.cpp",
      "framework": "doctest",
      "coverage_target": 0.8
    }
  },
  "context_specific_rules": [
    {
      "id": "cpp_core_engine",
      "name": "C++ Core Engine Files",
      "applies_to": {
        "file_extensions": [".cpp", ".h"],
        "directories": ["core/", "scene/", "servers/", "drivers/", "editor/", "main/"]
      },
      "rules": {
        "header_guards": "#pragma once",
        "include_order": ["platform_config.h", "core headers", "std library", "third-party"],
        "class_declaration": "GDCLASS(ClassName, BaseClass)",
        "virtual_methods": "use override keyword",
        "const_correctness": true,
        "getter_setter_naming": "get_*/set_*",
        "method_binding": "BIND_METHOD() macro",
        "copyright_header": true
      }
    },
    {
      "id": "gdscript_files",
      "name": "GDScript Files",
      "applies_to": {
        "file_extensions": [".gd"],
        "directories": ["modules/gdscript/", "game scripts"]
      },
      "rules": {
        "class_declaration": "class_name ClassName",
        "extends": "extends ParentClass",
        "type_hints": true,
        "signal_declaration": "signal signal_name(param: Type)",
        "export_variables": "@export annotation",
        "private_methods": "prefix with _",
        "docstrings": "## comments",
        "enums": "enum { VALUE1, VALUE2 }"
      }
    },
    {
      "id": "csharp_files",
      "name": "C# Files",
      "applies_to": {
        "file_extensions": [".cs"],
        "directories": ["modules/mono/"]
      },
      "rules": {
        "namespace": "namespace Godot",
        "partial_classes": true,
        "attributes": ["[Export]", "[Tool]", "[GodotClassNameAttribute]"],
        "properties": "auto-properties with { get; set; }",
        "null_safety": "#nullable enable",
        "async_methods": "async Task",
        "diagnostics": "suppress only necessary warnings"
      }
    },
    {
      "id": "scene_files",
      "name": "Scene Files",
      "applies_to": {
        "file_extensions": [".tscn"]
      },
      "rules": {
        "node_naming": "PascalCase",
        "resource_paths": "res:// prefix",
        "unique_names": "%NodeName syntax",
        "metadata": "add meaningful metadata"
      }
    },
    {
      "id": "resource_files",
      "name": "Resource Files",
      "applies_to": {
        "file_extensions": [".tres"]
      },
      "rules": {
        "resource_type": "specify correct class",
        "property_names": "snake_case",
        "nested_resources": "inline small, reference large"
      }
    },
    {
      "id": "build_system",
      "name": "Build System Files",
      "applies_to": {
        "file_names": ["SCsub", "SConstruct"],
        "file_extensions": [".py"]
      },
      "rules": {
        "indentation": "spaces (4 spaces)",
        "style": "PEP 8",
        "comments": "explain non-obvious logic",
        "conditionals": "if env[\"option\"]:"
      }
    },
    {
      "id": "python_files",
      "name": "Python Files",
      "applies_to": {
        "file_extensions": [".py"],
        "directories": ["misc/", "build scripts"]
      },
      "rules": {
        "indentation": "spaces (4 spaces)",
        "style": "PEP 8",
        "type_hints": true,
        "docstrings": "triple-quoted strings"
      }
    }
  ],
  "directory_rules": [
    {
      "path": "core/",
      "name": "Core Engine",
      "rules": [
        "Changes affect entire engine",
        "No dependencies on higher-level modules",
        "Performance critical - profile before changes",
        "Use custom allocators where appropriate",
        "Consider multi-threaded access patterns"
      ]
    },
    {
      "path": "scene/",
      "name": "Scene System",
      "rules": [
        "Respect parent-child relationships",
        "Use signals for loose coupling",
        "Implement _get_property_list() for dynamic properties",
        "Implement _get_state()/_set_state() for serialization"
      ]
    },
    {
      "path": "servers/",
      "name": "Server Subsystems",
      "rules": [
        "Servers are typically singletons",
        "May be accessed from multiple threads",
        "Manage RIDs (Resource IDs) carefully",
        "Follow subsystem-specific patterns"
      ]
    },
    {
      "path": "editor/",
      "name": "Editor-Only Code",
      "rules": [
        "Wrap in #ifdef TOOLS_ENABLED",
        "Follow editor UI conventions",
        "Use EditorUndoRedo for user actions",
        "Use EDITOR_GET() for editor preferences"
      ]
    },
    {
      "path": "modules/",
      "name": "Optional Modules",
      "rules": [
        "Minimize dependencies on other modules",
        "Use register_*_types() functions",
        "Provide config.py for build configuration",
        "Include module-specific documentation"
      ]
    },
    {
      "path": "platform/",
      "name": "Platform-Specific Code",
      "rules": [
        "Use platform defines for conditional compilation",
        "Implement platform interfaces",
        "Test on target platform before commit"
      ]
    },
    {
      "path": "tests/",
      "name": "Unit Tests",
      "rules": [
        "Mirror source directory structure",
        "Use test_*.cpp or test_*.h naming",
        "Use CHECK(), REQUIRE() from doctest",
        "Aim for >80% code coverage",
        "Add regression tests for fixed bugs"
      ]
    }
  ],
  "file_patterns": [
    {
      "pattern": "*.cpp",
      "language": "C++",
      "context": "Core Engine",
      "rules_id": "cpp_core_engine"
    },
    {
      "pattern": "*.h",
      "language": "C++",
      "context": "Core Engine",
      "rules_id": "cpp_core_engine"
    },
    {
      "pattern": "*.gd",
      "language": "GDScript",
      "context": "Game Scripts",
      "rules_id": "gdscript_files"
    },
    {
      "pattern": "*.cs",
      "language": "C#",
      "context": "Bindings",
      "rules_id": "csharp_files"
    },
    {
      "pattern": "*.tscn",
      "language": "Scene",
      "context": "Scene Files",
      "rules_id": "scene_files"
    },
    {
      "pattern": "*.tres",
      "language": "Resource",
      "context": "Resource Files",
      "rules_id": "resource_files"
    },
    {
      "pattern": "SCsub",
      "language": "Python",
      "context": "Build System",
      "rules_id": "build_system"
    },
    {
      "pattern": "SConstruct",
      "language": "Python",
      "context": "Build System",
      "rules_id": "build_system"
    },
    {
      "pattern": "*.py",
      "language": "Python",
      "context": "Tools/Build",
      "rules_id": "python_files"
    }
  ]
}

